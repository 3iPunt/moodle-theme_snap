define(["core/notification","core/ajax","core/templates","core/str"],function(a,b,c,d){var e=!1,f=!1,g=!1;return $(document).ready(function(){$("#fixy-logout").click(function(){f=!0})}),{ifErrorShowBestMsg:function(b,h,i){if(e)return!0;if(f)return!1;if("object"!=typeof b)try{var j=JSON.parse(b);b=j}catch(k){}if("undefined"==typeof b)return!1;var l=M.cfg.wwwroot+"/user/policy.php";if(b.errorcode&&"sitepolicynotagreed"===b.errorcode)return window.location!=l&&!g&&$("#primary-nav").is(":visible")&&(window.location=l,g=!0),!0;if(b.error||b.errorcode){if(M.snapTheme.forcePassChange){var m=M.cfg.wwwroot+"/login/change_password.php";return!(!$("#fixy-content").length||(d.get_string("forcepwdwarningpersonalmenu","theme_snap",m).done(function(a){var b={message:a,extraclasses:"force-pwd-warning"};c.render("core/notification_warning",b).done(function(a){$("#fixy-content").html("<br />"+a)})}),!$("#fixy-content").is(":visible")))||(window.location.href.indexOf("login/change_password.php")>-1||(window.location=m,e=!0,!0))}var n=function(b){if(i)a.alert(M.util.get_string("error","moodle"),i,M.util.get_string("ok","moodle"));else if(b.backtrace)a.exception(b);else{var c;if(b.error)c=b.error,b.stacktrace&&(c="<div>"+c+"<pre>"+b.stacktrace+"</pre></div>");else{if(!b.errorcode||!b.message)return!1;c=b.message}a.alert(M.util.get_string("error","moodle"),c,M.util.get_string("ok","moodle"))}};return h=h?h:"",$.ajax({type:"POST",async:!0,data:{sesskey:M.cfg.sesskey,failedactionmsg:h},url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_loginstatus"}).done(function(c){return!!e||void(c.loggedin?(console.log(b),n(b)):($("<style>.confirmation-dialogue .confirmation-buttons input:nth-of-type(2), .moodle-dialogue-base.moodle-dialogue-confirm button.yui3-button.closebutton{ display : none }</style>").appendTo("head"),a.confirm(c.loggedouttitle,c.loggedoutmsg,c.loggedoutcontinue," ",function(){window.location=M.cfg.wwwroot+"/login/index.php"}),e=!0))}),!0}return!1}}});