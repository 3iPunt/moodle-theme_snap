define(["jquery","core/ajax","core/notification","core/templates"],function(a,b,c,d){var e=function(e){var f=e.unavailablesections.map(Number),g=e.unavailablemods.map(Number);a(document).on("snap:module_completion_change",function(){b.call([{methodname:"theme_snap_course_completion",args:{courseshortname:e.shortname,unavailablesections:f.join(","),unavailablemods:g.join(",")},done:function(b){if(Object.keys(b.newlyavailablesectionhtml).length)for(var c in b.newlyavailablesectionhtml){var e=b.newlyavailablesectionhtml[c],h=e.number;a("#section-"+h+" .content > .snap-conditional-tag").remove()}var i=function(b,c){if(Object.keys(b).length)for(var d in b){var e=b[d],f=e.id?e.id:e.number,g=e.html,h="#"+c+"-"+f;"module"===c?a(h).replaceWith(g):(a(h+" ul.section").length?a(h+" ul.section").replaceWith(g):a(h+" nav.section_footer").before(g),a(h+" > .snap-conditional-tag").replaceWith(""))}};i(b.newlyavailablesectionhtml,"section"),i(b.newlyavailablemodhtml,"module"),d.render("theme_snap/course_toc",b.toc).done(function(b){a("#course-toc").replaceWith(b)}),f=b.unavailablesections.split(",").map(Number),g=b.unavailablemods.split(",").map(Number)},fail:function(a){c.exception(a)}}],!0,!0)})};return e});