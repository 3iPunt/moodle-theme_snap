define(["jquery","core/ajax","core/notification","core/templates"],function(a,b,c,d){var e=function(e){var f=e.unavailablesections.map(Number),g=e.unavailablemods.map(Number);a(document).on("snap:module_completion_change",function(){b.call([{methodname:"theme_snap_course_completion",args:{courseshortname:e.shortname,unavailablesections:f.join(","),unavailablemods:g.join(",")},done:function(b){if(Object.keys(b.newlyavailablesectionhtml).length)for(var c in b.newlyavailablesectionhtml)a("#section-"+c+" .content > .snap-restrictions-meta").remove();var e=function(b,c){if(Object.keys(b).length)for(var d in b){var e=b[d],f="#"+c+"-"+d;"module"===c?a(f).replaceWith(e):(a(f+" ul.section").length?a(f+" ul.section").replaceWith(e):a(f+" nav.section_footer").before(e),a(f+" > .snap-restrictions-meta .text-danger").replaceWith(""))}};e(b.newlyavailablesectionhtml,"section"),e(b.newlyavailablemodhtml,"module"),d.render("theme_snap/course_toc",b.toc).done(function(b){a("#course-toc").replaceWith(b)}),f=b.unavailablesections.split(",").map(Number),g=b.unavailablemods.split(",").map(Number)},fail:function(a){c.exception(a)}}],!0,!0)})};return e});