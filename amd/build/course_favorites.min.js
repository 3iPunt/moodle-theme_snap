define(["jquery","core/ajax","core/notification","core/templates","core/log"],function(a,b,c,d,e){return function(){e.enableAll(!0);var f=function(b,e){d.render("theme_snap/course_cards",b).done(function(b){a(e).replaceWith(b)}).fail(c.exception)},g=function(d){if(!a(d).hasClass("ajaxing")){a(d).addClass("ajaxing");var e="true"===a(d).attr("aria-pressed")?0:1,g=a(a(d).parents(".courseinfo")[0]),h=a(g).data("shortname");1===e?k(g,"#fixy-visible-courses .courseinfo.favorited","#fixy-visible-courses",!0):l(g),b.call([{methodname:"theme_snap_course_card",args:{courseshortname:h,favorited:e},done:function(b){f(b,g),a(d).removeClass("ajaxing")},fail:function(b){a(d).removeClass("ajaxing"),c.exception(b)}}],!0,!0)}},h=function(b){return parseInt(a(b).find(".courseinfo-body").data("courseid"))},i=function(b){return a(b).find(".coursefullname").html()},j=function(a,b){if(0===b.length)return-1;var c=[],d={};return b.each(function(){d={title:i(this),card:this},c.push(d)}),d={title:i(a),card:a},c.push(d),c.sort(function(a,b){var c=h(a.card),d=h(b.card);return a.title===b.title?c===d?0:c>d?1:-1:a.title>b.title?1:-1}),c.indexOf(d)},k=function(b,c,d,f){var g=a(c),h=j(b,g),i=h+1;e.debug("Moving card element into position "+i+" of list (size = "+g.length+") : "+c),i>0?i<=g.length?(e.debug("Moving card before position "+i+"  using selector "+c),a(c).eq(h).before(b)):(e.debug("Moving card after position "+g.length+" using selector "+c),a(c).eq(g.length-1).after(b)):(e.debug("Destination "+c+" empty"),f?(e.debug("prepending to "+d),a(d).prepend(b)):(e.debug("appending to "+d),a(d).append(b)))},l=function(b){var c;a(b).data("hidden")===!0?(c="#fixy-hidden-courses",a(".header-hidden-courses").addClass("state-visible"),a("#fixy-hidden-courses").is(":visible")||a("#fixy-hidden-courses").slideToggle("fast",function(){a("#fixy-hidden-courses").focus()})):c="#fixy-visible-courses",k(b,c+" .courseinfo:not(.favorited)",c,!1)};a("#fixy-my-courses").on("click",".favoritetoggle",function(a){a.preventDefault(),a.stopPropagation(),g(this)})}});