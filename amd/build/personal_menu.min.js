define(["jquery","core/log","core/yui","theme_snap/pm_course_cards","theme_snap/util"],function(a,b,c,d,e){var f=function(){var f=this;this.update=function(){d.reqCourseInfo(d.getCourseIds()),a("#primary-nav").focus(),a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").hide(0);var f=function(c){var d=a("#snap-personal-menu-"+c);if(a(d).length){var f=M.cfg.sesskey+"personal-menu-"+c;try{if(e.supportsSessionStorage()&&window.sessionStorage[f]){b.info("using locally stored "+c);var g=window.sessionStorage[f];a(d).html(g)}b.info("fetching "+c),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_"+c+"&contextid="+M.cfg.context,success:function(g){b.info("fetched "+c),e.supportsSessionStorage()&&"undefined"!=typeof g.html&&(window.sessionStorage[f]=g.html),a(d).attr("data-content-loaded","1"),a(d).html(g.html)}})}catch(h){sessionStorage.clear(),b.error(h)}}};f("deadlines"),f("graded"),f("grading"),f("messages"),f("forumposts"),a("#snap-personal-menu-badges").length&&"undefined"==typeof M.snap_message_badge&&e.whenTrue(function(){return"undefined"!=typeof M.snap_message_badge},function(){M.snap_message_badge.init_overlay(c)},!0),a(document).trigger("snapUpdatePersonalMenu")};var g=function(){a(document).on("click",".js-personal-menu-trigger",function(b){a("body").toggleClass("snap-fixy-open"),a(".snap-fixy-open #primary-nav").is(":visible")&&f.update(),b.preventDefault()}),a(document).on("click","#fixy-mobile-menu a",function(b){var c=this.getAttribute("href"),d=a("#fixy-content section"),e=a(d).outerWidth(),f=a(c),g=a(".callstoaction section > div").index(f)+1,h=e*g,i=a(c).outerHeight()+100;"#fixy-my-courses"==c&&(h=0);var j=a(window).height();j>i&&(i=j),a("#fixy-content").animate({left:"-"+h+"px",height:i+"px"},"fast","swing",function(){}),b.preventDefault()}),a(document).on("click","#fixy-close",function(){a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").css("display","")})};g()};return new f});