define(["jquery","core/log","core/templates","theme_snap/pm_course_cards_hidden","theme_snap/pm_course_favorites","theme_snap/model_view"],function(a,b,c,d,e,f){var g=function(){a(document).ready(function(){e(d);var g=!0;if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(h){g=!1}var i=[],j=M.cfg.sesskey+"courseinfo";if(a(".courseinfo").each(function(){i.push(a(this).attr("data-courseid"))}),i.length>0){var k=function(d){c.render("theme_snap/course_cards",[]).done(function(){for(var c in d){var e=d[c];b.debug("applying course data for courseid "+e.course);var g=a('.courseinfo[data-courseid="'+e.course+'"]');f(g,"theme_snap/course_cards"),a(g).trigger("modelUpdate",e)}})};if(window.sessionStorage[j]){var l=JSON.parse(window.sessionStorage[j]);k(l)}var m="courseids="+i.join(",");b.debug("fetching course data"),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_courseinfo&contextid="+M.cfg.context,data:m,success:function(a){a.info?(b.debug("fetched coursedata",a.info),g&&(window.sessionStorage[j]=JSON.stringify(a.info)),k(a.info)):b.warn("fetched coursedata with error: JSON data object is missing info property",a)}})}}),a("#fixy-my-courses").on("click hover",".courseinfo-teachers-more",null,function(b){b.preventDefault();var c=a(this).html();c.indexOf("+")>-1?a(this).html(c.replace("+","-")):a(this).html(c.replace("-","+")),a(this).parents(".courseinfo").toggleClass("show-all")}),a(document).on("click",".courseinfo[data-href]",function(b){var c=a(b.target),d="_self";a(c).closest("a").length||(window.open(a(this).data("href"),d),b.preventDefault())})};return new g});