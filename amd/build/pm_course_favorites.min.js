define(["jquery","core/ajax","core/notification","core/templates","core/log"],function(a,b,c,d,e){return function(f){e.enableAll(!0);var g=function(b,e){d.render("theme_snap/course_cards",b).done(function(b){var c=a(a.parseHTML(b));a(e).html(c.html()),a(e).attr("class",a(c).attr("class"))}).fail(c.exception)},h=function(d){if(!a(d).hasClass("ajaxing")){a(d).addClass("ajaxing");var e="true"===a(d).attr("aria-pressed")?0:1,f=a(a(d).parents(".courseinfo")[0]),h=a(f).data("shortname"),i=function(){b.call([{methodname:"theme_snap_course_card",args:{courseshortname:h,favorited:e},done:function(b){g(b,f),d=f.find(".favoritetoggle"),a(d).removeClass("ajaxing"),a(d).focus()},fail:function(b){a(d).removeClass("ajaxing"),c.exception(b)}}],!0,!0)};1===e?l(f,"#fixy-visible-courses .courseinfo.favorited","#fixy-visible-courses",!0,i):m(f,i)}},i=function(b){return parseInt(a(b).find(".courseinfo-body").data("courseid"))},j=function(b,c){c=!0;var d=a(b).find(".coursefullname").html();return c&&(d=d.toLowerCase()),d},k=function(a,b){if(0===b.length)return-1;var c=[],d={};return b.each(function(){d={title:j(this),card:this},c.push(d)}),d={title:j(a),card:a},c.push(d),c.sort(function(a,b){var c=i(a.card),d=i(b.card);return a.title===b.title?c===d?0:c>d?1:-1:a.title>b.title?1:-1}),c.indexOf(d)},l=function(b,c,d,g,h){var i=a(c),j=k(b,i),l=j+1;e.debug("Moving card element into position "+l+" of list (size = "+i.length+") : "+c),l>0?l<=i.length?(e.debug("Moving card before position "+l+"  using selector "+c),a(c).eq(j).before(b)):(e.debug("Moving card after position "+i.length+" using selector "+c),a(c).eq(i.length-1).after(b)):(e.debug("Destination "+c+" empty"),g?(e.debug("prepending to "+d),a(d).prepend(b)):(e.debug("appending to "+d),a(d).append(b))),f.updateToggleCount(),"function"==typeof h&&h()},m=function(b,c){var d;a(b).data("hidden")===!0?(d="#fixy-hidden-courses",a(".header-hidden-courses").addClass("state-visible"),a("#fixy-hidden-courses").is(":visible")||f.toggleHidden(!1)):d="#fixy-visible-courses",l(b,d+" .courseinfo:not(.favorited)",d,!1,c)};a("#fixy-my-courses").on("click",".favoritetoggle",function(a){a.preventDefault(),a.stopPropagation(),h(this)})}});